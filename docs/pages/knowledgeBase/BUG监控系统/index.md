基于bug监控系统的可行性研究报告
1.什么是bug监控系统

bug监控系统是一款监控工具，主要用于监控应用在运行周期内所产生的的缺陷，并记录传到相应的服务器中。开发者可以通过平台收集的信息来快速定位到问题的关键并进行修复。从而提升用户体验。

2.为什么要使用bug监控系统

工程师在开发时一定不止一次要去解决一些顽固的线上问题，也曾想方设法要去复现用户的bug，但由于没有bug监控系统的支持，结果可能都不太理想。怎样定位线上问题，一直以来，都是很头疼的问题，因为它发生于用户的一系列操作之后。错误的原因可能源于机型，网络环境，复杂的操作行为等等，在想要去解决的时候很难复现出来，自然也就无法解决。
当生产系统中产生了一个bug时，如何快速地得到报警？如何评估它的影响和紧迫性？如何快速地找到问题的根源？当修复完程序后，又如何知道它是否解决了问题？bug监控系统在帮助我们与现有流程集成时解答了这些问题。
例如，线上有一个bug，代码的某处逻辑的“TypeError: xxx is undefined”造成了这个问题，bug监控系统会立即发现错误，并通过邮件或其他基于通知规则的集成通知到相关责任人员，这个通知可以把我们引入到一个指示板，这个指示板为我们提供了快速分类问题所需的上下文，如：频率、用户影响、代码哪一部分受到影响以及哪个团队可能是问题的所有者。

3.常见的bug监控系统及方案

3.1阿里云实时监控服务ARMS

3.1.1简介

应用实时监控服务ARMS（Application Real-Time Monitoring Service）是一款应用性能管理（APM）产品，包含应用监控、Prometheus监控和前端监控三大子产品，涵盖分布式应用、容器环境、浏览器、小程序、APP等领域的性能管理，能实现全栈式性能监控和端到端全链路追踪诊断。
3.1.1支持的子产品和功能模块

3.1.1.1应用监控

ARMS应用监控是一款应用性能管理（Application Performance Management，简称 APM）产品。您无需修改代码，只需为应用安装一个探针，ARMS就能够对应用进行全方位监控，帮助您快速定位出错接口和慢接口、重现调用参数、发现系统瓶颈，从而大幅提升线上问题诊断的效率。

3.1.1.2前端监控

ARMS前端监控专注于对Web场景、Weex场景和小程序场景的监控，从页面打开速度（测速）、页面稳定性（JS Error）和外部服务调用成功率（API）这三个方面监测Web和小程序页面的健康度。

3.1.1.3 Prometheus监控

ARMS Prometheus监控全面对接开源Prometheus生态，支持类型丰富的组件监控，提供多种开箱即用的预置监控大盘，且提供全面托管的Prometheus服务。

3.1.2预估费用

应用监控、Prometheus监控和前端监控三大子产品是独立分开付费的，这里以前端监控为例进行介绍：
资源包价格
名称	规格	价格	折合计费单价	有效期
初级资源包	200万页面上报次数	¥ 420	0.21元 / 1000前端数据上报次数	6个月
中级资源包	1600万页面上报次数	¥ 2,520	0.158元 / 1000前端数据上报次数	1年
高级资源包	12800万页面上报次数	¥ 15,120	0.118元 / 1000前端数据上报次数	1年


预估费用详情
收费规则：
提供API上传免费额度，每日免费赠送50万次。
超过50万上传次数的部分，按照原先十分之一的价格进行计费。

预估每日上报流量
计算公式：每日上报流量 = PV +（API - 每天50万）* 0.1 + 自定义上报
金额计算公式：（上报流量 / 资源包容量）* 资源包单价

计费流量（万）=（200+（2000 - 50）* 0.1 + 20）* 30 = 12,450
金额（元） =（12,450 / 12800）* 15120 = 14,706
3.1.3优缺点
优点:
除了bug监控这项基础功能外，额外提供了检测页面测速、外部服务调用监控（API）、页面健康度、统计埋点等功能，能更全面的监控前端应用。
缺点:
统计数据只能保留最近3个月，必须使用公有云的方式接入，无法保证数据安全。
3.1.4合作伙伴
3.2 Fundebug
3.2.1简介
Fundebug提供全栈错误监控服务，通过邮件、钉钉、倍洽、Slack等第三方工具实时报警，提供全面的报错信息帮助用户快速分析问题，改进产品。通过记录程序异常的堆栈、网络请求错误、资源加载错误、并且记录用户行为利用独创的可视化重现技术来帮改进产品，提升产品体验。

3.2.2支持的开发语言
目前支持JavaScript、微信小程序、微信小游戏、支付宝小程序、ReactNative、Java、Node.js等开发语言的错误监控。

3.2.3支持的功能
支持邮件报警、错误智能聚合、控制台错误提醒、报错日报、错误评论、客服邮件支持、个性化定义错误过滤器、用户行为记录、Source Map支持、多种第三方报警、自定义报警规则、客服电话支持等功能。

3.2.4预估费用
普通付费版
套餐	月付费用	年付费用（8折）	事件数/月	成员	项目	数据保存
套餐一	¥ 127 /月	¥ 1,219 /年	15万	10个	20个	30天
套餐二	¥ 287 /月	¥ 2,755 /年	45万	20个	50个	30天
套餐三	¥ 687 /月	¥ 6,595 /年	150万	40个	100个	30天
套餐四	¥ 2,047 /月	¥ 19,651/年	450万	80个	200个	30天
本地付费版
套餐	年付
本地版使用Docker容器打包	¥ 30万 /年起
3.2.3优缺点
优点:
基于机器学习，聚合bug数据，避免重复报警，减少干扰。
强大的控制台智能排序，能根据发生的时间、次数、用户数等维度对bug进行过滤筛选。
团队协作方便，BUG即任务、支持任务分配及管理。
缺点:
根据天眼查显示，该企业最新一笔融资是2018年的天使轮融资，企业规模较小，稳定性欠缺。
不支持开发语言C#的监控。
私有化部署性价比不高。
使用公有云的方式接入，无法保证数据的安全性。
3.2.4合作伙伴

3.3 Sentry
3.3.1简介
Sentry是一个国外的异常监控开源平台, 它分为客户端和服务端，客户端(目前客户端有JavaScript, Java, Python, PHP,C#, Ruby等多种语言)就嵌入在你的应用程序中间，程序出现异常就向服务端发送消息，服务端将消息记录到数据库中并提供一个web节目方便查看。Sentry由python编写，源码开放，性能卓越，易于扩展，能帮助开发人员实时监控和修复错误，快速迭代，提高效率。提升用户体验。
3.3.2支持的开发语言

3.3.3支持的功能
支持邮件报警、错误智能聚合、控制台错误提醒、报错日报、错误评论、个性化定义错误过滤器、用户行为记录、Source Map支持、多种第三方报警、自定义报警规则等功能。
3.3.4预估费用
私有化部署（使用python或者Docker进行部署），根据实际占用的资源进行估算
3.3.5优缺点
优点:
项目开源免费，github的 star和fork数高，性能卓越，易于扩展。

支持大量语言，能满足当前的技术体系。
支持私有化部署，能保证数据的安全性。
对开发人员来说，可以快速部署，减少大量重复性劳动力。
缺点:
对服务性能的有一定损耗，需要占用3GB的运行内存。
只提供bug监控功能，无法提供应用监控功能。
需要额外的脚本来实现定期清理数据的功能。
3.3.6合作伙伴
Sentry的合作伙伴有Disqus, Path, mozilla, Pinterest等公司
3.4 Bugly
3.4.1简介
腾讯Bugly支持24小时Android崩溃异常监控，全面的Android崩溃捕获，Unity应用和游戏的崩溃监控，为您发现并上报所有崩溃信息。全面的Android ANR 分析，实时掌控Android ANR率，快速找到问题所在。支持全面的iOS卡顿分析，提升iOS应用的流畅度。
3.4.2支持语言
支持安卓、IOS、Android、Cocos2D和Unity3D这几种开发语言。
3.4.3支持的功能
支持邮件报警、错误智能聚合、控制台错误提醒等功能。
3.4.4预估费用
开源免费，仅适用于移动端
3.4.5优缺点
优点:
开源免费，移动端监控的首选。
缺点:
支持的开发语言较少，只支持移动端的监控。
3.4.5合作伙伴

3.5自研bug监控系统
3.5.1 运行流程

3.5.2支持的功能
支持邮件报警、错误智能聚合、控制台错误提醒、报错日报、错误评论、个性化定义错误过滤器、用户行为记录、Source Map支持、多种第三方报警、自定义报警规则等功能。
3.5.3 涉及到的技术点
探针SDK，需要支持的语言都要独立开发相应的探针SDK。
数据清洗，使用elasticsearch暂存数据，不作为长期存储，然后经过数据清洗分析数据，提取聚合重复的数据，整理为更小的数据。
数据持久化，将处理后的数据再存入在mysql，完成数据持久化，以便于后续进行分析处理
数据可视化，使用Echart或者D3对数据进行可视化处理。
监控告警，定义监控规则，通过邮件、钉钉等第三方工具实时报警按规则触发报警。
3.5.4 预估费用
私有化部署（使用python或者Docker进行部署），根据实际占用的资源进行估算
3.4.5优缺点
优点:
能根据业务方向进行自定义研发
支持私有化部署，能保证数据的安全性。
拥有bug监控，性能监控，API请求监控，数据埋点，无圈选埋点等功能，是一款应用监控工具
缺点:
研发周期长，开发难度大，人力成本高。
4.如何选择合适的Bug监控系统
4.1当前的技术背景
4.1.1技术体系
前端：JavaScript（小程序，Vue，React），Java（Android），C#
后端：Java
4.1.2支持的部署条件
支持通过docker进行私有化部署
4.1.3 jenkins现有任务数
一个jenkins任务通常表示一个需要进行监控的应用，这里统计目前线上有63个需要监控的应用



4.2 bug监控系统方案对比
	ARMS前端	Fundebug	Sentry	Bugly	自研监控
支持语言	1.JavaScript
2.微信小程序
3.钉钉小程序
4.支付宝小程序
5.Weex	1.JavaScript
2.微信小程序
3.微信小游戏
4.支付宝小程序
5.ReactNative
6.Java
7.Node.js	支持多种开发语言	1.Android
2.IOS
3.Cocos2D
4.Unity3D
	自定义
预估费用	假设30万的PV，则选用中级资源包¥ 2,520 /年	1.普通版套餐三 ¥ 6,595 /年
2.本地付费版¥ 30万/年起	1.本地Docker部署根据实际占用的资源进行计算	开源免费	1.本地Docker部署根据实际占用的资源进行计算
部署方式	1.使用官方提供的公有云服务	1.使用官方提供的公有云服务
2.使用Dokcer进行私有化部署	1.使用官方提供的公有云服务
2.使用Dokcer进行私有化部署	1.使用官方提供的公有云服务	1.使用Dokcer进行私有化部署
功能点	1.通过邮件报警
2.多种第三方报警
3.自定义报警规则
4.性能监控，5.API请求监控
6.数据埋点	1.邮件报警
2.错误智能聚合
3.控制台错误提醒
4.报错日报、错误评论
5.个性化定义错误过滤器
6.用户行为记录
7.多种第三方报警、
8.自定义报警规则	1.邮件报警
2.错误智能聚合
3.控制台错误提醒
4.报错日报、错误评论
5.个性化定义错误过滤器
6.用户行为记录
7.多种第三方报警、
8.自定义报警规则	1.邮件报警2.错误智能聚合
3.控制台错误提醒	1.邮件报警
2.错误智能聚合
3.控制台错误提醒
4.报错日报、错误评论
5.个性化定义错误过滤器
6.用户行为记录
7.多种第三方报警、
8.自定义报警规则
9.性能监控，10.API请求监控
11.数据埋点
安全性	数据存放在公有云服务。不安全	数据可存放在公有云服务也可存放在公司服务器，选择前者则不安全，选择后者则安全。	数据存放在公司服务器，安全	数据存放在公有云服务。不安全	数据存放在公司服务器，安全

4.3结论
4.3.1支持语言维度分析
ARMS前端方案方案在“支持语言”维度中的JavaScript和小程序领域能够较好的支持，同时也有ARMS App监控方案及ARMS JAVA应用监控方案能够对App和Java进行监控，但暂时没有对C#客户端提供相应的支持。
Fundebug方案能支持JavaScript，小程序，Java，但暂时没有对C#客户端提供相应的支持。
sentry方案的在“支持语言”维度中的表现最好，支持的语言广泛。
bugly方案由于支持的语言相对较少，无法完全支持我们现有技术栈，所以不推荐该方案。
自研监控方案需要自行开发各种语言探针SDK。
从支撑语言维度上来看，Bugly方案并不适合公司现有的技术体系。
4.3.2预估费用维度
ARMS前端方案花费是¥ 2,520 /年，ARMS App监控方案目前是不计费公测，ARMS JAVA应用监控方案目需要额外计算计费，下面是计费方式。

Fundebug方案花费是 ¥ 6,595 /年。
Sentry方案需根据实际占用的资源进行计算价格。
自研监控方案需根据实际占用的资源进行计算价格，由于自研项目开发周期长，需考虑人力成本。
从预估费用维度上来看，Fundebug方案+Bugly方案相较ARMS前端方案+ARMS App监控方案+ARMS JAVA应用监控方案有价格优势。Fundebug方案+ Bugly方案和Sentry方案、自研监控方案的价格对比，需要深入评估后面两者的实际占用的资源，Sentry方案相较自研监控，部署后即可使用，无需开发和考虑人力成本。
4.3.3部署方式维度
从部署方式维度可以得知ARMS前端方案+ARMS App监控方案+ARMS JAVA应用监控方案，Bugly方案使用官方提供的公有云服务，Fundebug方案、Sentry方案、自研监控方案均可采用使用Dokcer进行私有化部署

从部署方式上来看，私有化部署可控程度更高，且能保证数据的安全性。
4.3.3功能点维度
从功能点维度可以得知每个方案的功能点大同小异，均能满足日常使用，部分方案在做好bug监控的同时，也具备其它方面的功能，如ARMS前端方案还包括性能监控，API请求监控，数据埋点，无圈选埋点等功能，自研监控方案也可以该方向发展。
4.3.4安全性维度
从安全性维度可以得知。Fundebug和Sentry、自研监控方案提供私有化部署方式能有效的保证数据安全性。
4.3.5总结
综合上面多个维度的分析，结合公司的实际情况，利用Sentry搭建Bug监控平台是目前最为合适的落地方案。