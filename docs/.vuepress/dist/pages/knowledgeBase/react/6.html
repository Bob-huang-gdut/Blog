<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1. 对 Redux 的理解，主要解决什么问题 | 黄思博前端进阶</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog/logo.png">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <meta name="description" content="前端工程师,前端自学,高级前端工程师,中高级前端工程师,前端进阶知识,前端职业发展">
    
    <link rel="preload" href="/blog/assets/css/0.styles.e60b25d8.css" as="style"><link rel="preload" href="/blog/assets/js/app.199cf420.js" as="script"><link rel="preload" href="/blog/assets/js/2.132bf881.js" as="script"><link rel="preload" href="/blog/assets/js/38.a9e1b099.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.604fb0cb.js"><link rel="prefetch" href="/blog/assets/js/11.1b8c8ee8.js"><link rel="prefetch" href="/blog/assets/js/12.ab029745.js"><link rel="prefetch" href="/blog/assets/js/13.d7b39b56.js"><link rel="prefetch" href="/blog/assets/js/14.a41129d5.js"><link rel="prefetch" href="/blog/assets/js/15.dad4e260.js"><link rel="prefetch" href="/blog/assets/js/16.90517692.js"><link rel="prefetch" href="/blog/assets/js/17.d08b4738.js"><link rel="prefetch" href="/blog/assets/js/18.ce56af00.js"><link rel="prefetch" href="/blog/assets/js/19.d1c81d35.js"><link rel="prefetch" href="/blog/assets/js/20.ac71a316.js"><link rel="prefetch" href="/blog/assets/js/21.3cc5e5a9.js"><link rel="prefetch" href="/blog/assets/js/22.e7f11c05.js"><link rel="prefetch" href="/blog/assets/js/23.4ba17918.js"><link rel="prefetch" href="/blog/assets/js/24.14683dd2.js"><link rel="prefetch" href="/blog/assets/js/25.1bb2e336.js"><link rel="prefetch" href="/blog/assets/js/26.834e1803.js"><link rel="prefetch" href="/blog/assets/js/27.15ac0a73.js"><link rel="prefetch" href="/blog/assets/js/28.2c57830f.js"><link rel="prefetch" href="/blog/assets/js/29.b6368e20.js"><link rel="prefetch" href="/blog/assets/js/3.e02802b0.js"><link rel="prefetch" href="/blog/assets/js/30.a22e1ddc.js"><link rel="prefetch" href="/blog/assets/js/31.0969144f.js"><link rel="prefetch" href="/blog/assets/js/32.af9e02a9.js"><link rel="prefetch" href="/blog/assets/js/33.78c19638.js"><link rel="prefetch" href="/blog/assets/js/34.260fc635.js"><link rel="prefetch" href="/blog/assets/js/35.d816449b.js"><link rel="prefetch" href="/blog/assets/js/36.8a278581.js"><link rel="prefetch" href="/blog/assets/js/37.9520be77.js"><link rel="prefetch" href="/blog/assets/js/39.40eade19.js"><link rel="prefetch" href="/blog/assets/js/4.9f518c74.js"><link rel="prefetch" href="/blog/assets/js/40.129d3e38.js"><link rel="prefetch" href="/blog/assets/js/41.775e9262.js"><link rel="prefetch" href="/blog/assets/js/42.bdcba986.js"><link rel="prefetch" href="/blog/assets/js/43.c417c154.js"><link rel="prefetch" href="/blog/assets/js/44.8484dcd1.js"><link rel="prefetch" href="/blog/assets/js/45.23bd1c25.js"><link rel="prefetch" href="/blog/assets/js/46.70bf38f3.js"><link rel="prefetch" href="/blog/assets/js/47.1e8e6666.js"><link rel="prefetch" href="/blog/assets/js/48.ad206000.js"><link rel="prefetch" href="/blog/assets/js/49.4a12fbab.js"><link rel="prefetch" href="/blog/assets/js/5.8369cf44.js"><link rel="prefetch" href="/blog/assets/js/50.9c95ac13.js"><link rel="prefetch" href="/blog/assets/js/51.8080073f.js"><link rel="prefetch" href="/blog/assets/js/52.f26da335.js"><link rel="prefetch" href="/blog/assets/js/53.ef21c825.js"><link rel="prefetch" href="/blog/assets/js/54.59cb54dc.js"><link rel="prefetch" href="/blog/assets/js/55.0ce33c39.js"><link rel="prefetch" href="/blog/assets/js/56.14731ca8.js"><link rel="prefetch" href="/blog/assets/js/57.bddacbaf.js"><link rel="prefetch" href="/blog/assets/js/58.b2566365.js"><link rel="prefetch" href="/blog/assets/js/59.b038a661.js"><link rel="prefetch" href="/blog/assets/js/6.67fb8021.js"><link rel="prefetch" href="/blog/assets/js/60.aade6765.js"><link rel="prefetch" href="/blog/assets/js/61.24f41660.js"><link rel="prefetch" href="/blog/assets/js/62.b89d40ec.js"><link rel="prefetch" href="/blog/assets/js/63.c9a28c5d.js"><link rel="prefetch" href="/blog/assets/js/64.23eae325.js"><link rel="prefetch" href="/blog/assets/js/65.6ad6fed6.js"><link rel="prefetch" href="/blog/assets/js/66.4f8dd626.js"><link rel="prefetch" href="/blog/assets/js/67.e4cdaca3.js"><link rel="prefetch" href="/blog/assets/js/7.cd8d8194.js"><link rel="prefetch" href="/blog/assets/js/8.0c2c994c.js"><link rel="prefetch" href="/blog/assets/js/9.05f573fb.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.e60b25d8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">黄思博前端进阶</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/pages/knowledgeBase/" class="nav-link router-link-active">
  知识库
</a></div><div class="nav-item"><a href="/blog/pages/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/blog/pages/question/" class="nav-link">
  每日·一题
</a></div><div class="nav-item"><a href="/blog/pages/summary/" class="nav-link">
  个人总结
</a></div><div class="nav-item"><a href="https://github.com/Bob-huang-gdut" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/pages/knowledgeBase/" class="nav-link router-link-active">
  知识库
</a></div><div class="nav-item"><a href="/blog/pages/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/blog/pages/question/" class="nav-link">
  每日·一题
</a></div><div class="nav-item"><a href="/blog/pages/summary/" class="nav-link">
  个人总结
</a></div><div class="nav-item"><a href="https://github.com/Bob-huang-gdut" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/pages/knowledgeBase/" aria-current="page" class="sidebar-link">知识库</a></li><li><a href="/blog/pages/knowledgeBase/html/" class="sidebar-link">html</a></li><li><a href="/blog/pages/knowledgeBase/css/" class="sidebar-link">css</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>react</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/pages/knowledgeBase/react/1.html" class="sidebar-link">一、组件基础</a></li><li><a href="/blog/pages/knowledgeBase/react/2.html" class="sidebar-link">二、数据管理</a></li><li><a href="/blog/pages/knowledgeBase/react/3.html" class="sidebar-link">三、生命周期</a></li><li><a href="/blog/pages/knowledgeBase/react/4.html" class="sidebar-link">四、组件通信</a></li><li><a href="/blog/pages/knowledgeBase/react/5.html" class="sidebar-link">五、路由</a></li><li><a href="/blog/pages/knowledgeBase/react/6.html" aria-current="page" class="active sidebar-link">六、Redux</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/pages/knowledgeBase/react/7.html" class="sidebar-link">七、Hooks</a></li><li><a href="/blog/pages/knowledgeBase/react/8.html" class="sidebar-link">八、虚拟DOM</a></li><li><a href="/blog/pages/knowledgeBase/react/9.html" class="sidebar-link">九、其他</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/blog/pages/knowledgeBase/browser/" class="sidebar-link">浏览器</a></li><li><a href="/blog/pages/knowledgeBase/network/" class="sidebar-link">计算机网络</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>手写代码</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端安全</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="_1-对-redux-的理解-主要解决什么问题"><a href="#_1-对-redux-的理解-主要解决什么问题" class="header-anchor">#</a> 1. 对 Redux 的理解，主要解决什么问题</h3> <p>React是视图层框架。Redux是一个用来管理数据状态和UI状态的JavaScript应用工具。随着JavaScript单页应用（SPA）开发日趋复杂， JavaScript需要管理比任何时候都要多的state（状态）， Redux就是降低管理难度的。（Redux支持React、Angular、jQuery甚至纯JavaScript）。</p> <p>在 React 中，UI 以组件的形式来搭建，组件之间可以嵌套组合。但 React 中组件间通信的数据流是单向的，顶层组件可以通过 props 属性向下层组件传递数据，而下层组件不能向上层组件传递数据，兄弟组件之间同样不能。这样简单的单向数据流支撑起了 React 中的数据可控性。</p> <p>当项目越来越大的时候，管理数据的事件或回调函数将越来越多，也将越来越不好管理。管理不断变化的 state 非常困难。如果一个 model 的变化会引起另一个 model 变化，那么当 view 变化时，就可能引起对应 model 以及另一个 model 的变化，依次地，可能会引起另一个 view 的变化。直至你搞不清楚到底发生了什么。state 在什么时候，由于什么原因，如何变化已然不受控制。 当系统变得错综复杂的时候，想重现问题或者添加新功能就会变得举步维艰。如果这还不够糟糕，考虑一些来自前端开发领域的新需求，如更新调优、服务端渲染、路由跳转前请求数据等。state 的管理在大项目中相当复杂。</p> <p>Redux 提供了一个叫 store 的统一仓储库，组件通过 dispatch 将 state 直接传入store，不用通过其他的组件。并且组件通过 subscribe 从 store获取到 state 的改变。使用了 Redux，所有的组件都可以从 store 中获取到所需的 state，他们也能从store 获取到 state 的改变。这比组件之间互相传递数据清晰明朗的多。</p> <p><strong>主要解决的问题：</strong> 单纯的Redux只是一个状态机，是没有UI呈现的，react- redux作用是将Redux的状态机和React的UI呈现绑定在一起，当你dispatch action改变state的时候，会自动更新页面。</p> <h3 id="_2-redux-原理及工作流程"><a href="#_2-redux-原理及工作流程" class="header-anchor">#</a> 2. Redux 原理及工作流程</h3> <p><strong>（1）原理</strong> Redux源码主要分为以下几个模块文件</p> <ul><li>compose.js 提供从右到左进行函数式编程</li> <li>createStore.js 提供作为生成唯一store的函数</li> <li>combineReducers.js 提供合并多个reducer的函数，保证store的唯一性</li> <li>bindActionCreators.js 可以让开发者在不直接接触dispacth的前提下进行更改state的操作</li> <li>applyMiddleware.js 这个方法通过中间件来增强dispatch的功能</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>const actionTypes = {
    ADD: 'ADD',
    CHANGEINFO: 'CHANGEINFO',
}

const initState = {
    info: '初始化',
}

export default function initReducer(state=initState, action) {
    switch(action.type) {
        case actionTypes.CHANGEINFO:
            return {
                ...state,
                info: action.preload.info || '',
            }
        default:
            return { ...state };
    }
}

export default function createStore(reducer, initialState, middleFunc) {

    if (initialState &amp;&amp; typeof initialState === 'function') {
        middleFunc = initialState;
        initialState = undefined;
    }

    let currentState = initialState;

    const listeners = [];

    if (middleFunc &amp;&amp; typeof middleFunc === 'function') {
        // 封装dispatch 
        return middleFunc(createStore)(reducer, initialState);
    }

    const getState = () =&gt; {
        return currentState;
    }

    const dispatch = (action) =&gt; {
        currentState = reducer(currentState, action);

        listeners.forEach(listener =&gt; {
            listener();
        })
    }

    const subscribe = (listener) =&gt; {
        listeners.push(listener);
    }

    return {
        getState,
        dispatch,
        subscribe
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p><strong>（2）工作流程</strong></p> <ul><li>const store= createStore（fn）生成数据;</li> <li>action: {type: Symble('action01), payload:'payload' }定义行为;</li> <li>dispatch发起action：store.dispatch(doSomething('action001'));</li> <li>reducer：处理action，返回新的state;</li></ul> <p>通俗点解释：</p> <ul><li>首先，用户（通过View）发出Action，发出方式就用到了dispatch方法</li> <li>然后，Store自动调用Reducer，并且传入两个参数：当前State和收到的Action，Reducer会返回新的State</li> <li>State—旦有变化，Store就会调用监听函数，来更新View</li></ul> <p>以 store 为核心，可以把它看成数据存储中心，但是他要更改数据的时候不能直接修改，数据修改更新的角色由Reducers来担任，store只做存储，中间人，当Reducers的更新完成以后会通过store的订阅来通知react component，组件把新的状态重新获取渲染，组件中也能主动发送action，创建action后这个动作是不会执行的，所以要dispatch这个action，让store通过reducers去做更新React Component 就是react的每个组件。</p> <h3 id="_3-redux-中异步的请求怎么处理"><a href="#_3-redux-中异步的请求怎么处理" class="header-anchor">#</a> 3. Redux 中异步的请求怎么处理</h3> <p>可以在 componentDidmount 中直接进⾏请求⽆须借助redux。但是在⼀定规模的项⽬中,上述⽅法很难进⾏异步流的管理,通常情况下我们会借助redux的异步中间件进⾏异步处理。redux异步流中间件其实有很多，当下主流的异步中间件有两种redux-thunk、redux-saga。</p> <p><strong>（1）使用react-thunk中间件</strong></p> <p><strong>redux-thunk</strong>优点:</p> <ul><li>体积⼩: redux-thunk的实现⽅式很简单,只有不到20⾏代码</li> <li>使⽤简单: redux-thunk没有引⼊像redux-saga或者redux-observable额外的范式,上⼿简单</li></ul> <p><strong>redux-thunk</strong>缺陷:</p> <ul><li>样板代码过多: 与redux本身⼀样,通常⼀个请求需要⼤量的代码,⽽且很多都是重复性质的</li> <li>耦合严重: 异步操作与redux的action偶合在⼀起,不⽅便管理</li> <li>功能孱弱: 有⼀些实际开发中常⽤的功能需要⾃⼰进⾏封装</li></ul> <p>使用步骤：</p> <ul><li>配置中间件，在store的创建中配置</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>import {createStore, applyMiddleware, compose} from 'redux';
import reducer from './reducer';
import thunk from 'redux-thunk'

// 设置调试工具
const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ ? window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({}) : compose;
// 设置中间件
const enhancer = composeEnhancers(
  applyMiddleware(thunk)
);

const store = createStore(reducer, enhancer);

export default store;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>添加一个返回函数的actionCreator，将异步请求逻辑放在里面</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>/**
  发送get请求，并生成相应action，更新store的函数
  @param url {string} 请求地址
  @param func {function} 真正需要生成的action对应的actionCreator
  @return {function} 
*/
// dispatch为自动接收的store.dispatch函数 
export const getHttpAction = (url, func) =&gt; (dispatch) =&gt; {
    axios.get(url).then(function(res){
        const action = func(res.data)
        dispatch(action)
    })
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>生成action，并发送action</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>componentDidMount(){
    var action = getHttpAction('/getData', getInitTodoItemAction)
    // 发送函数类型的action时，该action的函数体会自动执行
    store.dispatch(action)
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>（2）使用redux-saga中间件</strong></p> <p><strong>redux-saga</strong>优点:</p> <ul><li>异步解耦: 异步操作被被转移到单独 saga.js 中，不再是掺杂在 action.js 或 component.js 中</li> <li>action摆脱thunk function: dispatch 的参数依然是⼀个纯粹的 action (FSA)，⽽不是充满 “⿊魔法” thunk function</li> <li>异常处理: 受益于 generator function 的 saga 实现，代码异常/请求失败 都可以直接通过 try/catch 语法直接捕获处理</li> <li>功能强⼤: redux-saga提供了⼤量的Saga 辅助函数和Effect 创建器供开发者使⽤,开发者⽆须封装或者简单封装即可使⽤</li> <li>灵活: redux-saga可以将多个Saga可以串⾏/并⾏组合起来,形成⼀个⾮常实⽤的异步flow</li> <li>易测试，提供了各种case的测试⽅案，包括mock task，分⽀覆盖等等</li></ul> <p><strong>redux-saga</strong>缺陷:</p> <ul><li>额外的学习成本: redux-saga不仅在使⽤难以理解的 generator function,⽽且有数⼗个API,学习成本远超redux-thunk,最重要的是你的额外学习成本是只服务于这个库的,与redux-observable不同,redux-observable虽然也有额外学习成本但是背后是rxjs和⼀整套思想</li> <li>体积庞⼤: 体积略⼤,代码近2000⾏，min版25KB左右</li> <li>功能过剩: 实际上并发控制等功能很难⽤到,但是我们依然需要引⼊这些代码</li> <li>ts⽀持不友好: yield⽆法返回TS类型</li></ul> <p>redux-saga可以捕获action，然后执行一个函数，那么可以把异步代码放在这个函数中，使用步骤如下：</p> <ul><li>配置中间件</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>import {createStore, applyMiddleware, compose} from 'redux';
import reducer from './reducer';
import createSagaMiddleware from 'redux-saga'
import TodoListSaga from './sagas'

const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ ? window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({}) : compose;
const sagaMiddleware = createSagaMiddleware()

const enhancer = composeEnhancers(
  applyMiddleware(sagaMiddleware)
);

const store = createStore(reducer, enhancer);
sagaMiddleware.run(TodoListSaga)

export default store;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>将异步请求放在sagas.js中</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>import {takeEvery, put} from 'redux-saga/effects'
import {initTodoList} from './actionCreator'
import {GET_INIT_ITEM} from './actionTypes'
import axios from 'axios'

function* func(){
    try{
        // 可以获取异步返回数据
        const res = yield axios.get('/getData')
        const action = initTodoList(res.data)
        // 将action发送到reducer
        yield put(action)
    }catch(e){
        console.log('网络请求失败')
    }
}

function* mySaga(){
    // 自动捕获GET_INIT_ITEM类型的action，并执行func
    yield takeEvery(GET_INIT_ITEM, func)
}

export default mySaga

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><ul><li>发送action</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>componentDidMount(){
  const action = getInitTodoItemAction()
  store.dispatch(action)
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_4-redux-怎么实现属性传递-介绍下原理"><a href="#_4-redux-怎么实现属性传递-介绍下原理" class="header-anchor">#</a> 4. Redux 怎么实现属性传递，介绍下原理</h3> <p>react-redux 数据传输∶ view--&gt;action--&gt;reducer--&gt;store--&gt;view。看下点击事件的数据是如何通过redux传到view上：</p> <ul><li>view 上的AddClick 事件通过mapDispatchToProps 把数据传到action ---&gt; click:()=&gt;dispatch(ADD)</li> <li>action 的ADD 传到reducer上</li> <li>reducer传到store上 const store = createStore(reducer);</li> <li>store再通过 mapStateToProps 映射穿到view上text:State.text</li></ul> <p>代码示例∶</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import React from 'react';
import ReactDOM from 'react-dom';
import { createStore } from 'redux';
import { Provider, connect } from 'react-redux';
class App extends React.Component{
    render(){
        let { text, click, clickR } = this.props;
        return(
            &lt;div&gt;
                &lt;div&gt;数据:已有人{text}&lt;/div&gt;
                &lt;div onClick={click}&gt;加人&lt;/div&gt;
                &lt;div onClick={clickR}&gt;减人&lt;/div&gt;
            &lt;/div&gt;
        )
    }
}
const initialState = {
    text:5
}
const reducer = function(state,action){
    switch(action.type){
        case 'ADD':
            return {text:state.text+1}
        case 'REMOVE':
            return {text:state.text-1}
        default:
            return initialState;
    }
}

let ADD = {
    type:'ADD'
}
let Remove = {
    type:'REMOVE'
}

const store = createStore(reducer);

let mapStateToProps = function (state){
    return{
        text:state.text
    }
}

let mapDispatchToProps = function(dispatch){
    return{
        click:()=&gt;dispatch(ADD),
        clickR:()=&gt;dispatch(Remove)
    }
}

const App1 = connect(mapStateToProps,mapDispatchToProps)(App);

ReactDOM.render(
    &lt;Provider store = {store}&gt;
        &lt;App1&gt;&lt;/App1&gt;
    &lt;/Provider&gt;,document.getElementById('root')
)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><h3 id="_5-redux-中间件是什么-接受几个参数-柯里化函数两端的参数具体是什么"><a href="#_5-redux-中间件是什么-接受几个参数-柯里化函数两端的参数具体是什么" class="header-anchor">#</a> 5. Redux 中间件是什么？接受几个参数？柯里化函数两端的参数具体是什么？</h3> <p>Redux 的中间件提供的是位于 action 被发起之后，到达 reducer 之前的扩展点，换而言之，原本 view -→&gt; action -&gt; reducer -&gt; store 的数据流加上中间件后变成了 view -&gt; action -&gt; middleware -&gt; reducer -&gt; store ，在这一环节可以做一些&quot;副作用&quot;的操作，如异步请求、打印日志等。</p> <p>applyMiddleware源码：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>export default function applyMiddleware(...middlewares) {
    return createStore =&gt; (...args) =&gt; {
        // 利用传入的createStore和reducer和创建一个store
        const store = createStore(...args)
        let dispatch = () =&gt; {
            throw new Error()
        }
        const middlewareAPI = {
            getState: store.getState,
            dispatch: (...args) =&gt; dispatch(...args)
        }
        // 让每个 middleware 带着 middlewareAPI 这个参数分别执行一遍
        const chain = middlewares.map(middleware =&gt; middleware(middlewareAPI))
        // 接着 compose 将 chain 中的所有匿名函数，组装成一个新的函数，即新的 dispatch
        dispatch = compose(...chain)(store.dispatch)
        return {
            ...store,
            dispatch
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>从applyMiddleware中可以看出∶</p> <ul><li>redux中间件接受一个对象作为参数，对象的参数上有两个字段 dispatch 和 getState，分别代表着 Redux Store 上的两个同名函数。</li> <li>柯里化函数两端一个是 middewares，一个是store.dispatch</li></ul> <h3 id="_6-redux-请求中间件如何处理并发"><a href="#_6-redux-请求中间件如何处理并发" class="header-anchor">#</a> 6. Redux 请求中间件如何处理并发</h3> <p><strong>使用redux-Saga</strong> redux-saga是一个管理redux应用异步操作的中间件，用于代替 redux-thunk 的。它通过创建 Sagas 将所有异步操作逻辑存放在一个地方进行集中处理，以此将react中的同步操作与异步操作区分开来，以便于后期的管理与维护。 redux-saga如何处理并发：</p> <ul><li><strong>takeEvery</strong></li></ul> <p>可以让多个 saga 任务并行被 fork 执行。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import {
    fork,
    take
} from &quot;redux-saga/effects&quot;

const takeEvery = (pattern, saga, ...args) =&gt; fork(function*() {
    while (true) {
        const action = yield take(pattern)
        yield fork(saga, ...args.concat(action))
    }
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li><strong>takeLatest</strong></li></ul> <p>takeLatest 不允许多个 saga 任务并行地执行。一旦接收到新的发起的 action，它就会取消前面所有 fork 过的任务（如果这些任务还在执行的话）。 在处理 AJAX 请求的时候，如果只希望获取最后那个请求的响应， takeLatest 就会非常有用。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import {
    cancel,
    fork,
    take
} from &quot;redux-saga/effects&quot;

const takeLatest = (pattern, saga, ...args) =&gt; fork(function*() {
    let lastTask
    while (true) {
        const action = yield take(pattern)
        if (lastTask) {
            yield cancel(lastTask) // 如果任务已经结束，则 cancel 为空操作
        }
        lastTask = yield fork(saga, ...args.concat(action))
    }
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_7-redux-状态管理器和变量挂载到-window-中有什么区别"><a href="#_7-redux-状态管理器和变量挂载到-window-中有什么区别" class="header-anchor">#</a> 7. Redux 状态管理器和变量挂载到 window 中有什么区别</h3> <p>两者都是存储数据以供后期使用。但是Redux状态更改可回溯——Time travel，数据多了的时候可以很清晰的知道改动在哪里发生，完整的提供了一套状态管理模式。</p> <p>随着 JavaScript 单页应用开发日趋复杂，JavaScript 需要管理比任何时候都要多的 state （状态）。 这些 state 可能包括服务器响应、缓存数据、本地生成尚未持久化到服务器的数据，也包括 UI状态，如激活的路由，被选中的标签，是否显示加载动效或者分页器等等。</p> <p>管理不断变化的 state 非常困难。如果一个 model 的变化会引起另一个 model 变化，那么当 view 变化时，就可能引起对应 model 以及另一个model 的变化，依次地，可能会引起另一个 view 的变化。直至你搞不清楚到底发生了什么。state 在什么时候，由于什么原因，如何变化已然不受控制。 当系统变得错综复杂的时候，想重现问题或者添加新功能就会变得举步维艰。 如果这还不够糟糕，考虑一些来自前端开发领域的新需求，如更新调优、服务端渲染、路由跳转前请求数据等等。前端开发者正在经受前所未有的复杂性，难道就这么放弃了吗?当然不是。</p> <p>这里的复杂性很大程度上来自于：我们总是将两个难以理清的概念混淆在一起：变化和异步。 可以称它们为曼妥思和可乐。如果把二者分开，能做的很好，但混到一起，就变得一团糟。一些库如 React 视图在视图层禁止异步和直接操作 DOM来解决这个问题。美中不足的是，React 依旧把处理 state 中数据的问题留给了你。Redux就是为了帮你解决这个问题。</p> <h3 id="_8-mobox-和-redux-有什么区别"><a href="#_8-mobox-和-redux-有什么区别" class="header-anchor">#</a> 8. mobox 和 redux 有什么区别？</h3> <p><strong>（1）共同点</strong></p> <ul><li>为了解决状态管理混乱，无法有效同步的问题统一维护管理应用状态;</li> <li>某一状态只有一个可信数据来源（通常命名为store，指状态容器）;</li> <li>操作更新状态方式统一，并且可控（通常以action方式提供更新状态的途径）;</li> <li>支持将store与React组件连接，如react-redux，mobx- react;</li></ul> <p><strong>（2）区别</strong> Redux更多的是遵循Flux模式的一种实现，是一个 JavaScript库，它关注点主要是以下几方面∶</p> <ul><li><p>Action∶ 一个JavaScript对象，描述动作相关信息，主要包含type属性和payload属性∶</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>o type∶ action 类型; o payload∶ 负载数据;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>Reducer∶ 定义应用状态如何响应不同动作（action），如何更新状态;</p></li> <li><p>Store∶ 管理action和reducer及其关系的对象，主要提供以下功能∶</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>o 维护应用状态并支持访问状态(getState());
o 支持监听action的分发，更新状态(dispatch(action)); 
o 支持订阅store的变更(subscribe(listener));

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>异步流∶ 由于Redux所有对store状态的变更，都应该通过action触发，异步任务（通常都是业务或获取数据任务）也不例外，而为了不将业务或数据相关的任务混入React组件中，就需要使用其他框架配合管理异步任务流程，如redux-thunk，redux-saga等;</p></li></ul> <p>Mobx是一个透明函数响应式编程的状态管理库，它使得状态管理简单可伸缩∶</p> <ul><li>Action∶定义改变状态的动作函数，包括如何变更状态;</li> <li>Store∶ 集中管理模块状态（State）和动作(action)</li> <li>Derivation（衍生）∶ 从应用状态中派生而出，且没有任何其他影响的数据</li></ul> <p><strong>对比总结：</strong></p> <ul><li>redux将数据保存在单一的store中，mobx将数据保存在分散的多个store中</li> <li>redux使用plain object保存数据，需要手动处理变化后的操作;mobx适用observable保存数据，数据变化后自动处理响应的操作</li> <li>redux使用不可变状态，这意味着状态是只读的，不能直接去修改它，而是应该返回一个新的状态，同时使用纯函数;mobx中的状态是可变的，可以直接对其进行修改</li> <li>mobx相对来说比较简单，在其中有很多的抽象，mobx更多的使用面向对象的编程思维;redux会比较复杂，因为其中的函数式编程思想掌握起来不是那么容易，同时需要借助一系列的中间件来处理异步和副作用</li> <li>mobx中有更多的抽象和封装，调试会比较困难，同时结果也难以预测;而redux提供能够进行时间回溯的开发工具，同时其纯函数以及更少的抽象，让调试变得更加的容易</li></ul> <h3 id="_9-redux-和-vuex-有什么区别-它们的共同思想"><a href="#_9-redux-和-vuex-有什么区别-它们的共同思想" class="header-anchor">#</a> 9. Redux 和 Vuex 有什么区别，它们的共同思想</h3> <p><strong>（1）Redux 和 Vuex区别</strong></p> <ul><li>Vuex改进了Redux中的Action和Reducer函数，以mutations变化函数取代Reducer，无需switch，只需在对应的mutation函数里改变state值即可</li> <li>Vuex由于Vue自动重新渲染的特性，无需订阅重新渲染函数，只要生成新的State即可</li> <li>Vuex数据流的顺序是∶View调用store.commit提交对应的请求到Store中对应的mutation函数-&gt;store改变（vue检测到数据变化自动渲染）</li></ul> <p>通俗点理解就是，vuex 弱化 dispatch，通过commit进行 store状态的一次更变；取消了action概念，不必传入特定的 action形式进行指定变更；弱化reducer，基于commit参数直接对数据进行转变，使得框架更加简易;</p> <p><strong>（2）共同思想</strong></p> <ul><li>单—的数据源</li> <li>变化可以预测</li></ul> <p>本质上∶ redux与vuex都是对mvvm思想的服务，将数据从视图中抽离的一种方案。</p> <h3 id="_10-redux-中间件是怎么拿到store-和-action-然后怎么处理"><a href="#_10-redux-中间件是怎么拿到store-和-action-然后怎么处理" class="header-anchor">#</a> 10. Redux 中间件是怎么拿到store 和 action? 然后怎么处理?</h3> <p>redux中间件本质就是一个函数柯里化。redux applyMiddleware Api 源码中每个middleware 接受2个参数， Store 的getState 函数和dispatch 函数，分别获得store和action，最终返回一个函数。该函数会被传入 next 的下一个 middleware 的 dispatch 方法，并返回一个接收 action 的新函数，这个函数可以直接调用 next（action），或者在其他需要的时刻调用，甚至根本不去调用它。调用链中最后一个 middleware 会接受真实的 store的 dispatch 方法作为 next 参数，并借此结束调用链。所以，middleware 的函数签名是（{ getState，dispatch })=&gt; next =&gt; action。</p> <h3 id="_11-redux中的connect有什么作用"><a href="#_11-redux中的connect有什么作用" class="header-anchor">#</a> 11. Redux中的connect有什么作用</h3> <p>connect负责连接React和Redux</p> <p><strong>（1）获取state</strong></p> <p>connect 通过 context获取 Provider 中的 store，通过<code>store.getState()</code> 获取整个store tree 上所有state</p> <p><strong>（2）包装原组件</strong></p> <p>将state和action通过props的方式传入到原组件内部 wrapWithConnect 返回—个 ReactComponent 对 象 Connect，Connect 重 新 render 外部传入的原组件 WrappedComponent ，并把 connect 中传入的 mapStateToProps，mapDispatchToProps与组件上原有的 props合并后，通过属性的方式传给WrappedComponent</p> <p><strong>（3）监听store tree变化</strong></p> <p>connect缓存了store tree中state的状态，通过当前state状态 和变更前 state 状态进行比较，从而确定是否调用 <code>this.setState()</code>方法触发Connect及其子组件的重新渲染</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/5/2021, 12:32:29 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/pages/knowledgeBase/react/5.html" class="prev">
        五、路由
      </a></span> <span class="next"><a href="/blog/pages/knowledgeBase/react/7.html">
        七、Hooks
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.199cf420.js" defer></script><script src="/blog/assets/js/2.132bf881.js" defer></script><script src="/blog/assets/js/38.a9e1b099.js" defer></script>
  </body>
</html>
